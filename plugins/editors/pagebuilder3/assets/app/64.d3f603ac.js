webpackJsonppagefly([64],{683:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"default",function(){return W}),n.d(e,"PresetStyled",function(){return L}),n.d(e,"Preset",function(){return F}),n.d(e,"PresetItem",function(){return J}),n.d(e,"UIToobarStyle",function(){return U}),n.d(e,"PresetEmpty",function(){return Y});var i,r,s=n(361),o=n.n(s),a=n(141),l=n.n(a),p=n(349),c=n.n(p),d=n(350),u=n.n(d),h=n(351),f=n.n(h),g=n(352),m=n.n(g),y=n(13),x=n.n(y),v=n(29),P=n.n(v),k=n(79),S=(n.n(k),n(387)),b=(n.n(S),n(358)),_=n(365),w=(n(371),n(369)),R=(n(363),n(380)),C=n(356),B=n(368),E=n(435),N=n(146),O=n(534),D=n.n(O),T=n(374),A=n(144),z=n.n(A),M=o()(["\n\tposition: absolute;\n\tleft: 100px;\n\ttop: 100px;\n\tz-index: 5000;\n\tbackground: ",";\n\twidth: 300px;\n\theight: 300px;\n\tflex-direction: column;\n\tdisplay: ",";\n\n\t& > header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tflex: 0 0 auto;\n\t\tpadding: 6px 0px 6px 15px;\n\t\tbackground-color: ",";\n\t\tborder-bottom: 1px solid ",";\n\t\tcolor: ",";\n\t\ttext-transform: capitalize;\n\t\tline-height: 1em;\n\t\tfont-size: 14px;\n\t}\n\n\t& > header + div {\n\t\theight: 100%;\n\t}\n"],["\n\tposition: absolute;\n\tleft: 100px;\n\ttop: 100px;\n\tz-index: 5000;\n\tbackground: ",";\n\twidth: 300px;\n\theight: 300px;\n\tflex-direction: column;\n\tdisplay: ",";\n\n\t& > header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tflex: 0 0 auto;\n\t\tpadding: 6px 0px 6px 15px;\n\t\tbackground-color: ",";\n\t\tborder-bottom: 1px solid ",";\n\t\tcolor: ",";\n\t\ttext-transform: capitalize;\n\t\tline-height: 1em;\n\t\tfont-size: 14px;\n\t}\n\n\t& > header + div {\n\t\theight: 100%;\n\t}\n"]),K=o()(["\n\t",";\n\t&.preset__block {\n\t\tpadding: 10px 15px !important;\n\t\ttext-align: center;\n\t}\n\t&.preset__button {\n\t\tdisplay: inline-block;\n\t\tmargin: 0 !important;\n\t}\n\t&.preset__text {\n\t\tline-height: 1.5em;\n\t\tpadding: 0 !important;\n\t}\n\t&.preset__block.preset__empty,\n\t&.preset__default {\n\t\tpadding: 10px 15px !important;\n\t\ttext-align: center;\n\t\tborder: 1px dotted #999;\n\t}\n"],["\n\t",";\n\t&.preset__block {\n\t\tpadding: 10px 15px !important;\n\t\ttext-align: center;\n\t}\n\t&.preset__button {\n\t\tdisplay: inline-block;\n\t\tmargin: 0 !important;\n\t}\n\t&.preset__text {\n\t\tline-height: 1.5em;\n\t\tpadding: 0 !important;\n\t}\n\t&.preset__block.preset__empty,\n\t&.preset__default {\n\t\tpadding: 10px 15px !important;\n\t\ttext-align: center;\n\t\tborder: 1px dotted #999;\n\t}\n"]),j=o()(["\n\tcursor: pointer;\n\tpadding: 10px;\n\t> div {\n\t\tmargin: 0 !important;\n\t}\n\t&:hover {\n\t\tbackground: ",";\n\t}\n\n\t&[data-selected='true'] {\n\t\tbackground: ",";\n\t\tborder-top: 1px solid ",";\n\t\tborder-bottom: 1px solid ",";\n\t}\n\th5 {\n\t\tmargin-top: 0;\n\t\tmargin-bottom: 5px;\n\t}\n"],["\n\tcursor: pointer;\n\tpadding: 10px;\n\t> div {\n\t\tmargin: 0 !important;\n\t}\n\t&:hover {\n\t\tbackground: ",";\n\t}\n\n\t&[data-selected='true'] {\n\t\tbackground: ",";\n\t\tborder-top: 1px solid ",";\n\t\tborder-bottom: 1px solid ",";\n\t}\n\th5 {\n\t\tmargin-top: 0;\n\t\tmargin-bottom: 5px;\n\t}\n"]),H=o()(["\n\t& a {\n\t\tline-height: 34px;\n\t\theight: 36px;\n\t\tmin-width: 65px;\n\t\t+ a {\n\t\t\tmargin-left: 10px;\n\t\t}\n\t}\n"],["\n\t& a {\n\t\tline-height: 34px;\n\t\theight: 36px;\n\t\tmin-width: 65px;\n\t\t+ a {\n\t\t\tmargin-left: 10px;\n\t\t}\n\t}\n"]),I=o()(["\n\tfont-size: 12px;\n\tpadding: 10px 15px;\n\tmargin: 15px;\n\ttext-align: center;\n\tborder: 1px dotted #999;\n"],["\n\tfont-size: 12px;\n\tpadding: 10px 15px;\n\tmargin: 15px;\n\ttext-align: center;\n\tborder: 1px dotted #999;\n"]),W=(r=i=function(t){function e(){var t;c()(this,e);for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];var s=f()(this,(t=e.__proto__||l()(e)).call.apply(t,[this].concat(i)));return s.tmpDiv=P()("<div>").css({opacity:.5,position:"absolute",pointerEvents:"none",zIndex:9999999}),P()(s.get("app.element")).append(P()(s.tmpDiv)),s}return m()(e,t),u()(e,[{key:"onShowPreset",value:function(){var t=this,e=this.get("app.page.selected"),n=x.a.filter(this.presets,function(t){return e.state.preset===t.key}),i=x.a.isEmpty(n)?{key:"",name:"Default"}:n[0];this.setState({hide:!1,presets:this.presets,selected:i,oldSelected:i,target:e},function(){t.refreshSelected(t.state.selected),t.updatePosition(),t.invoke("app.clickOutside",t.el,t.onClickOutSide)})}},{key:"onApplyPreset",value:function(t){this.get("app.page.selected").saveState({preset:t||""})}},{key:"onCancelPreset",value:function(){var t=this.get("app.page");this.state.oldPresetKey||t.selected.state.oldStyle||t.selected.setState({preset:""}),!this.state.oldPresetKey&&t.selected.state.oldStyle&&x.a.defer(function(){t.selected.style.cssText=t.selected.state.oldStyle,t.selected.setState({preset:"",oldStyle:""})}),this.state.oldPresetKey&&!t.selected.state.oldStyle&&this.trigger("preset:onApplyPreset",this.state.oldPresetKey),this.state.oldPresetKey&&t.selected.state.oldStyle&&(this.trigger("preset:onApplyPreset",this.state.oldPresetKey),x.a.defer(function(){t.selected.style.cssText=t.selected.state.oldStyle,t.selected.setState({oldStyle:""})})),this.trigger("preset:onHidePreset")}},{key:"onAddNewPreset",value:function(t){this.get("app.page.head").insertChild({type:t,name:this.getDefaultStyleName(t)})}},{key:"onSaveNewPreset",value:function(t){var e=this,n=this.get("app.page.selected"),i=this.get("app.page"),r=n.style.cssText,s=n.state.preset?n.customHash(i.key,n.state.preset,i.state.items[n.state.preset].type):"",o=x.a.filter(i.head.children,function(t){return n.customHash(i.key,t.key,t.type)===s})[0],a=void 0,l=void 0;if(l="Preset.BlockPreset"===t?n.displayName:n.DOMNode.innerText.trim()){a=l+" "+(this.getLastIndOfSameName(this.presets,l)+1||"")}else a=this.getDefaultStyleName(t);i.head.insertChild({type:t,name:a},function(t){i.getStyleRule(t.selector).style.cssText=o?o.style.cssText+r:t.style.cssText+r,e.trigger("preset:onApplyPreset",t.key),e.app.launch("notify").then(function(t){t.addNotification({level:"success",message:"Saved new style successfully!"})})})}},{key:"onDeletePreset",value:function(t){var e=this;x.a.each(this.get("app.page.state.items"),function(n,i){t.key===n.preset&&e.invoke("app.page.getElement",i).then(function(t){t.setState({preset:""})})})}},{key:"onHidePreset",value:function(){this.setState({hide:!0})}},{key:"onClickOutSide",value:function(){this.trigger("preset:onHidePreset"),this.target&&this.target.setState({oldStyle:""}),this.refreshSelected(this.state.oldSelected)}},{key:"onResetPreset",value:function(){this.selectPreset(""),this.refreshSelected({key:"",name:""})}},{key:"componentWillMount",value:function(){this.setState({hide:!0,presets:[],selected:{key:"",name:""},oldSelected:{key:"",name:""},target:void 0})}},{key:"componentDidMount",value:function(){var t=this;this.listenTo(this.app,"element:remove",function(e){t.onDeletePreset(e)}),this.listenTo(this.app,"presetpickerview:show",function(e){t.setState({oldPresetKey:e||""},function(){t.trigger("preset:onShowPreset")})}),this.listenTo(this.app,"presetpickerview:save",function(e){t.trigger("preset:onSaveNewPreset",e)}),this.listenTo(this.app,"presetpickerview:add",function(e){t.trigger("preset:onAddNewPreset",e)}),this.on("preset:onShowPreset",function(){t.onShowPreset()}),this.on("preset:onClickOutSide",function(){t.onClickOutSide()}),this.on("preset:onApplyPreset",function(e){t.onApplyPreset(e)}),this.on("preset:onCancelPreset",function(){t.onCancelPreset()}),this.on("preset:onHidePreset",function(){t.onHidePreset()}),this.on("preset:onSaveNewPreset",function(e){t.onSaveNewPreset(e)}),this.on("preset:onAddNewPreset",function(e){t.onAddNewPreset(e)}),this.on("preset:onResetPreset",function(){t.onResetPreset()})}},{key:"componentWillStoreState",value:function(){return{}}},{key:"componentWillRestoreState",value:function(){return{}}},{key:"updatePosition",value:function(){var t=this,e=this.get("parent.parent.__toolbar.el.el"),n=this.get("context.editor.mainEl");if(e&&n){var i=this.targetBoundingBox;this.tmpDiv.css(i),P()(this.el).position({my:"bottom",at:"top",of:this.tmpDiv,collision:"flipfit",within:n,using:function(e,r){r.element.element.css({top:e.top,left:e.left}),Object(N.c)(i,t.el.getBoundingClientRect())&&P()(t.el).position({my:"left",at:"right",of:t.tmpDiv,collision:"flipfit",within:n,using:function(e,s){r.element.element.css({top:e.top,left:e.left}),Object(N.c)(i,t.el.getBoundingClientRect())&&P()(t.el).position({my:"bottom",at:"top",of:t.toolBarEl,collision:"flipfit",within:n})}})}})}}},{key:"mathPosition",value:function(t){var e=t.left,n=t.top,i=t.width,r=t.height,s=this.app.left,o=this.app.top,a=this.app.width,l=this.app.height,p=e+i-a,c=n+r-l;return p>0?(e-=p,e<s&&(e=s,i=a),e+i>a&&(i=a-e)):e<s&&(e=s),c>0?(n-=c,n<o&&(n=o,r=l),n+r>l&&(r=l-n)):n<o&&(n=o),{left:e,top:n,width:i,height:r}}},{key:"selectPreset",value:function(t){var e=this;this.setState({selected:t},function(){e.trigger("preset:onApplyPreset",e.state.selected.key)})}},{key:"refreshSelected",value:function(t){var e=P()(Object(k.findDOMNode)(this.presetCollection));e.find("div[data-selected]").removeAttr("data-selected"),e.find("[data-key='"+t.key+"']").attr("data-selected",!0)}},{key:"getDefaultStyleName",value:function(t){var e=this.get("app.page"),n=x.a.map(e.head.state.children,function(t,n){return e.getElement(t)}).filter(function(e){return e.type===t}),i={"Preset.ButtonPreset":"Button","Preset.BlockPreset":"Box","Preset.TextPreset":"Text"},r=i[t]+" Style";return r+" "+(this.getLastIndOfSameName(n,r)+1||"")}},{key:"getLastIndOfSameName",value:function(t,e){return x.a.chain(t).filter(function(t){return t.name.indexOf(e)>=0}).map(function(t){return parseInt(t.name.replace(e+" ","0"),10)}).sortBy(function(t){return t}).last().value()}},{key:"handleWheel",value:function(){return function(t){t.stopPropagation(),t.preventDefault()}}},{key:"render",value:function(){var t=this;return b.React.createElement(_.Overlay,{innerRef:function(e){return t.overlay=e},css:this.props.overlayCSS||"",onKeyDown:function(t){return t.stopPropagation()},onWheel:this.handleWheel(),hidden:this.state.hide,overlay:!0},b.React.createElement(E.default,{onStart:function(e,n){t.dragStart=P()(t.el).offset()},onDrag:function(e,n){var i=t.dragStart.left+n.x,r=t.dragStart.top+n.y,s=t.el.getBoundingClientRect(),o=s.width,a=s.height,l=t.mathPosition({left:i,top:r,width:o,height:a});P()(t.el).css(l)}},b.React.createElement(L,{innerRef:function(e){return t.el=e},hide:this.state.hide},b.React.createElement("header",null,b.React.createElement("span",null,"Styles")),b.React.createElement(w.default,null,0!==this.state.presets.length?b.React.createElement(B.default,{selectable:!0,collection:this.state.presets,onSelect:function(e){t.selectPreset(e)},ref:function(e){return t.presetCollection=e}},function(e){var n={},i=!1;void 0!==t.state.target&&(e.key!==t.state.selected&&e.key!==t.state.selected.key||(i=!0),""!==e.key&&(n=e.style.cssText));var r=D()(e.name,{length:15}),s=void 0;s="Preset.ButtonPreset"===e.type?"preset__button":"Preset.TextPreset"===e.type?"preset__text":"Preset.BlockPreset"===e.type?"preset__block":"preset__default";var o=""!==n?s:s+" preset__empty",a="";if("Preset.BlockPreset"===e.type){var l=n.match(/background-color: ([^;]+);/);a=z()(l?l[1]:"#fff").isLight()?"#000":"#FFF"}return b.React.createElement(J,{"data-key":e.key,selected:i,style:"Preset.ButtonPreset"===e.type?{textAlign:"center"}:{}},b.React.createElement(F,{css:n,className:o,style:{color:a}},r))}):b.React.createElement(Y,{className:"preset-empty"},"You have not had any style here")),b.React.createElement(R.default,{style:{justifyContent:"flex-end",padding:10},footer:!0},b.React.createElement(U,null,b.React.createElement(C.default,{onClick:function(){t.trigger("preset:onResetPreset")},danger:!0,size:"sm"},"Reset"),b.React.createElement(C.default,{onClick:function(){t.trigger("preset:onCancelPreset")},size:"sm"},"Cancel"))))))}},{key:"targetBoundingBox",get:function(){var t=this.get("parent.parent.el"),e=this.get("parent.parent.__toolbar.el.el"),n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),r={top:Math.min(n.top,i.top),bottom:Math.max(n.bottom,i.bottom),left:Math.min(n.left,i.left),right:Math.max(n.right,i.right),width:0,height:0};return r.width=r.right-r.left,r.height=r.bottom-r.top,r}},{key:"presets",get:function(){var t="",e=this.get("app.page.selected");return e&&x.a.each(T.h,function(n,i){-1!==x.a.indexOf(n,e.type)&&(t=i)}),""===t&&(t="Preset.BlockPreset"),e&&e.page.head.children&&x.a.filter(e.page.head.children,function(e){return e.type===t})||[]}}]),e}(b.default),i.APP_POS="selection",r),L=b.styled.div(M,function(t){return t.theme.panel.bg},function(t){return t.hide?"none":"flex"},function(t){return t.theme.panel.header},function(t){return t.theme.panel.header},function(t){return t.theme.panel.text}),F=b.styled.div(K,function(t){return t.css}),J=b.styled.div(j,function(t){return t.theme.button.bg_hover},function(t){return t.theme.field.bg_active},function(t){return t.theme.field.border_active},function(t){return t.theme.field.border_active}),U=b.styled.div(H),Y=b.styled.div(I)}});